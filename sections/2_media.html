<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>API Documentation</title>

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="../javascripts/all.js" type="text/javascript"></script>

    <script>
      $(function() {
        var toc = $("#toc").tocify({
          selectors: "h1,h2",
          extendPage: false,
          theme: "none",
          smoothScroll: false,
          showEffectSpeed: 0,
          hideEffectSpeed: 180,
          ignoreSelector: ".toc-ignore",
          hashGenerator: 'pretty',
          highlightOffset: 60,
          scrollTo: -2,
          scrollHistory: true,
          hashGenerator: function(text, element) {
            return element[0].getAttribute('id');
          }
        }).data("toc-tocify");
        // Hack to make already open sections to start opened,
        // instead of displaying an ugly animation
        setTimeout(function() {
          toc.setOption("showEffectSpeed", 180);
        },50);
        setupLanguages([
        ]);
      });
    </script>
  </head>

  <body class="sections sections_2_media">
    <div class="tocify-wrapper">
      <a href="/">
        <img src="../images/logo.png" />
      </a>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="content">
        <h1 id="toc_0">Media</h1>

<p>The Medium resource has the following attributes:</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>String</td>
<td><code class="prettyprint">email</code>, <code class="prettyprint">sms</code>, or <code class="prettyprint">jabber</code></td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>interval</td>
<td>Integer</td>
<td></td>
</tr>
<tr>
<td>rollup_threshold</td>
<td>Integer</td>
<td></td>
</tr>
</tbody></table>

<h2 id="toc_1">Create media for a contact</h2>
<pre class="highlight shell">curl -w <span class="s1">'response: %{http_code} \n'</span> -X POST -H <span class="s2">&quot;Content-Type: application/vnd.api+json&quot;</span> -d <span class="se">\</span>
 <span class="s1">'{
    &quot;media&quot;: [
      {
        &quot;type&quot; : &quot;email&quot;,
        &quot;address&quot; : &quot;johns@example.com&quot;,
        &quot;interval&quot; : 120,
        &quot;rollup_threshold&quot; : 5
      }
    ]
  }'</span> <span class="se">\</span>
 http://localhost:3081/contacts/5/media
</pre><pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'flapjack-diner'</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.base_uri</span><span class="p">(</span><span class="s1">'localhost:3081'</span><span class="p">)</span>

<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.create_contact_media</span><span class="p">(</span>
  <span class="s1">'5'</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">'type'</span>             <span class="o">=&gt;</span> <span class="s1">'email'</span><span class="p">,</span>
    <span class="s1">'address'</span>          <span class="o">=&gt;</span> <span class="s1">'johns@example.com'</span><span class="p">,</span>
    <span class="s1">'interval'</span>         <span class="o">=&gt;</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s1">'rollup_threshold'</span> <span class="o">=&gt;</span> <span class="mi">5</span>
  <span class="p">}</span>
<span class="p">)</span>
</pre>
<h3 id="toc_2">HTTP Request</h3>

<p><code class="prettyprint">POST /contacts/CONTACT_ID/media</code></p>

<h3 id="toc_3">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>media</td>
<td>Array[Medium]</td>
<td>An array of Medium resources to create.</td>
</tr>
</tbody></table>

<h3 id="toc_4">HTTP Return Codes</h3>

<table><thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>The submitted media resources were created successfully.</td>
</tr>
<tr>
<td>405</td>
<td><strong>Error</strong> The submitted media data was not sent with the JSONAPI MIME type <code class="prettyprint">application/vnd.api+json</code>.</td>
</tr>
<tr>
<td>409</td>
<td><strong>Error</strong> Media with ids matching those submitted were found.</td>
</tr>
<tr>
<td>422</td>
<td><strong>Error</strong> The submitted media data did not conform to the provided specification.</td>
</tr>
</tbody></table>

<h2 id="toc_5">Get media</h2>

<p>If no media ids are provided then all media resources will be returned; if media ids
are provided then only the media resources matching those ids will be returned.</p>

<p>NB: Ids for media resources are currently represented by a String
containing the id of the associated contact, an underscore and then the type
of the medium in question. This is for backwards compatibility, and is due to
some historical design decisions, but is likely to change when the data
handling code is reworked.</p>
<pre class="highlight shell">curl http://localhost:3081/media

<span class="c"># or</span>
curl http://localhost:3081/media/1_email

<span class="c"># or</span>
curl http://localhost:3081/media/21_jabber,22_jabber
</pre><pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'flapjack-diner'</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.base_uri</span><span class="p">(</span><span class="s1">'localhost:3081'</span><span class="p">)</span>

<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.media</span>

<span class="c1"># or</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.media</span><span class="p">(</span><span class="s1">'1_email'</span><span class="p">)</span>

<span class="c1"># or</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.media</span><span class="p">(</span><span class="s1">'21_jabber'</span><span class="p">,</span> <span class="s1">'22_jabber'</span><span class="p">)</span>
</pre>
<blockquote>
<p>The commands return JSON structured like this, which is broken up by Flapjack::Diner into its constituent hashes:</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">&quot;media&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;21_sms&quot;</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sms&quot;</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0123456789&quot;</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;rollup_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">&quot;contacts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;21&quot;</span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;22_email&quot;</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abcde@example.com&quot;</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">180</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;rollup_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="s2">&quot;links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">&quot;contacts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;22&quot;</span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h3 id="toc_6">HTTP Request</h3>

<p><code class="prettyprint">GET /media</code></p>

<p><strong>or</strong></p>

<p><code class="prettyprint">GET /media/ID[,ID,ID...]</code></p>

<h3 id="toc_7">Query Parameters</h3>

<p>None.</p>

<h3 id="toc_8">HTTP Return Codes</h3>

<table><thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>OK</td>
</tr>
</tbody></table>

<h2 id="toc_9">Update media</h2>

<p>Update one or more attributes for one or more media resources.</p>
<pre class="highlight shell">curl -w <span class="s1">'response: %{http_code} \n'</span> -X PATCH -H <span class="s2">&quot;Content-Type: application/json-patch+json&quot;</span> -d <span class="se">\</span>
<span class="s1">'[
  {&quot;op&quot;    : &quot;replace&quot;,
   &quot;path&quot;  : &quot;/media/0/address&quot;,
   &quot;value&quot; : &quot;0123456789&quot;},
  {&quot;op&quot;    : &quot;replace&quot;,
   &quot;path&quot;  : &quot;/media/0/interval&quot;,
   &quot;value&quot; : 10}
]'</span> <span class="se">\</span>
 <span class="s1">'http://localhost:3081/media/21_sms'</span>
</pre><pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'flapjack-diner'</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.base_uri</span><span class="p">(</span><span class="s1">'localhost:3081'</span><span class="p">)</span>

<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.update_media</span><span class="p">(</span>
  <span class="s1">'21_sms'</span><span class="p">,</span>
  <span class="ss">:address</span>  <span class="o">=&gt;</span> <span class="s1">'0123456789'</span><span class="p">,</span>
  <span class="ss">:interval</span> <span class="o">=&gt;</span> <span class="mi">10</span>
<span class="p">)</span>
</pre>
<h3 id="toc_10">HTTP Request</h3>

<p><code class="prettyprint">PATCH /media/ID[,ID,ID...]</code></p>

<h3 id="toc_11">Query Parameters</h3>

<p>Parameters sent for medium updates must form a valid <a href="http://tools.ietf.org/html/rfc6902">JSON Patch (RFC 6902)</a> document. This is comprised of a bare JSON array of JSON-Patch operation objects, which have three members:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>op</td>
<td>String</td>
<td>may only be <em>replace</em></td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>&ldquo;/media/0/ATTRIBUTE&rdquo; (e.g. &lsquo;address&rsquo;)</td>
</tr>
<tr>
<td>value</td>
<td>-&gt;</td>
<td>a value of the correct data type for the attribute in the path</td>
</tr>
</tbody></table>

<h3 id="toc_12">HTTP Return Codes</h3>

<table><thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>204</td>
<td>The submitted medium updates were made successfully. No content is returned.</td>
</tr>
<tr>
<td>404</td>
<td>Media resources could not be found for one or more of the provided ids. No media resources were altered by this request.</td>
</tr>
<tr>
<td>405</td>
<td><strong>Error</strong> The submitted media data was not sent with the JSON-Patch MIME type <code class="prettyprint">application/json-patch+json</code>.</td>
</tr>
</tbody></table>

<h2 id="toc_13">Delete media</h2>

<p>Delete one or more media resources.</p>
<pre class="highlight shell">curl -w <span class="s1">'response: %{http_code} \n'</span> -X DELETE <span class="se">\</span>
  <span class="s1">'http://localhost:3081/media/11_email'</span>

<span class="c"># or</span>
curl -w <span class="s1">'response: %{http_code} \n'</span> -X DELETE <span class="se">\</span>
  <span class="s1">'http://localhost:3081/media/31_jabber,32_jabber'</span>
</pre><pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'flapjack-diner'</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.base_uri</span><span class="p">(</span><span class="s1">'localhost:3081'</span><span class="p">)</span>

<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.delete_media</span><span class="p">(</span><span class="s1">'11_email'</span><span class="p">)</span>

<span class="c1"># or</span>
<span class="no">Flapjack</span><span class="o">::</span><span class="no">Diner</span><span class="nf">.delete_media</span><span class="p">(</span><span class="s1">'31_jabber'</span><span class="p">,</span> <span class="s1">'32_jabber'</span><span class="p">)</span>
</pre>
<h3 id="toc_14">HTTP Request</h3>

<p><code class="prettyprint">DELETE /media/ID[,ID,ID...]</code></p>

<h3 id="toc_15">Query Parameters</h3>

<p>None.</p>

<h3 id="toc_16">HTTP Return Codes</h3>

<table><thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>204</td>
<td>The medium/media resources were deleted</td>
</tr>
<tr>
<td>404</td>
<td>Media resources could not be found for one or more of the provided ids. No media resources were deleted by this request.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
        <div id="lang-selector">
        </div>
      </div>
    </div>
  </body>
</html>
