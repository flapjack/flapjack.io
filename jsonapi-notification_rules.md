# [JSON API](jsonapi) :: Notification Rules

## Endpoints

<ul>
  <li><a href="#get_contacts_id_notification_rules">GET /contacts/CONTACT_ID/notification_rules</a></li>
  <li><a href="#get_notification_rules_id">GET /notification_rules/RULE_ID</a></li>
  <li><a href="#post_notification_rules">POST /notification_rules</a></li>
  <li><a href="#put_notification_rules_id">PUT, DELETE /notification_rules/RULE_ID</a></li>
</ul>


<a id="get_contacts_id_notification_rules">&nbsp;</a>
### GET /contacts/CONTACT_ID/notification_rules

Lists a contact's notification rules.

**Example**
```bash
curl http://localhost:3081/contacts/21/notification_rules
```
**Response** Status: 200 OK
```json
[
  {
    "id": "08f607c7-618d-460a-b3fe-868464eb6045",
    "contact_id": "21",
    "tags": [
      "database",
      "physical"
    ],
    "entities": [
      "foo-app-01.example.com"
    ],
    "time_restrictions": [
      {
        "start_time": "2013-01-28 08:00:00",
        "end_time": "2013-01-28 18:00:00",
        "rrules": [
          {
            "validations": {
              "day": [1,2,3,4,5]
            },
            "rule_type": "Weekly",
            "interval": 1,
            "week_start": 0
          }
        ],
        "exrules": [],
        "rtimes": [],
        "extimes": []
      }
    ],
    "unknown_media": [],
    "warning_media": [
      "email"
    ],
    "critical_media": [
      "sms",
      "email"
    ],
    "unknown_blackhole": false,
    "warning_blackhole": false,
    "critical_blackhole": false
  },
  {
    "id": "2be654d8-9ad4-42b7-963d-f6727dc302a2",
    "contact_id": "21",
    "tags": [
      "database",
      "physical"
    ],
    "entities": [
      "foo-app-02.example.com"
    ],
    "time_restrictions": [],
    "unknown_media": [],
    "warning_media": [
      "email"
    ],
    "critical_media": [
      "sms",
      "email"
    ],
    "unknown_blackhole": false,
    "warning_blackhole": false,
    "critical_blackhole": false
  }
]
```

<a id="get_notification_rules_id">&nbsp;</a>
### GET /notification_rules/RULE_ID

Returns a specified notification rule.

**Example**
```bash
curl -w 'response: %{http_code} \n' http://localhost:3081/notification_rules/08f607c7-618d-460a-b3fe-868464eb6045
```
**Response** Status: 200 OK
```json
{
  "notification_rules": [
    {
      "id": "08f607c7-618d-460a-b3fe-868464eb6045",
      "contact_id": "21",
      "tags": [
        "database",
        "physical"
      ],
      "entities": [
        "foo-app-01.example.com"
      ],
      "time_restrictions": [
        {
          "start_time": "2013-01-28 08:00:00",
          "end_time": "2013-01-28 18:00:00",
          "rrules": [
            {
              "validations": {
                "day": [1,2,3,4,5]
              },
              "rule_type": "Weekly",
              "interval": 1,
              "week_start": 0
            }
          ],
          "exrules": [],
          "rtimes": [],
          "extimes": []
        }
      ],
      "unknown_media": [],
      "warning_media": [
        "email"
      ],
      "critical_media": [
        "sms",
        "email"
      ],
      "unknown_blackhole": false,
      "warning_blackhole": false,
      "critical_blackhole": false
    }
  ]
}
```

<a id="post_notification_rules">&nbsp;</a>
### POST /notification_rules

Creates a new notification rule.

**Example**
```bash
curl -w 'response: %{http_code} \n' -X POST -H "Content-type: application/json" -d \
 '{
    "notification_rules": [
      {
        "contact_id": "21",
        "tags": [
          "database",
          "physical"
        ],
        "entities": [
          "foo-app-01.example.com"
        ],
        "time_restrictions": [
          {
            "start_time": "2013-01-28 08:00:00",
            "end_time": "2013-01-28 18:00:00",
            "rrules": [
              {
                "validations": {
                  "day": [1,2,3,4,5]
                },
                "rule_type": "Weekly",
                "interval": 1,
                "week_start": 0
              }
            ],
            "exrules": [],
            "rtimes": [],
            "extimes": []
          }
        ],
        "unknown_media": [],
        "warning_media": [
          "email"
        ],
        "critical_media": [
          "sms",
          "email"
        ],
        "unknown_blackhole": false,
        "warning_blackhole": false,
        "critical_blackhole": false
      }
    ]
  }' \
http://localhost:3081/notification_rules
```
**Response** Status: 200 OK

Returns the notification rule object as per GET.

**Notes:**
* the rule_id will be generated by flapjack as a UUID and supplied in the response body along with the rest of the contact's information
* time_restrictions are implemented within flapjack by the ice_cube gem, which is an implementation of the iCalendar RFC for Ruby. The interface we're exposing is close to ice_cube's hash representation of a schedule.
* in time_restrictions, the start_time and end_time should contain no timezone information, or UTC offset. They will be interpreted by flapjack as being in the user's local timezone, or the timezone configured in processor/default_contact_timezone in the flapjack configuration.
* in time_restrictions, the day validations are numbers corresponding to days of the week, as per the UNIX crontab file. Week days start on Sunday - 0, and progress through to Saturday - 6. So a day validation of "[1,2,3,4,5]" means Monday through Friday.
* time_restrictions rule_type specifies on what basis the time restriction schedule is to be repeated. It can be one of "Secondly", "Minutely", "Hourly", "Daily", "Weekly", "Monthly", or "Yearly".

<a id="put_notification_rules_id">&nbsp;</a>
### PUT, DELETE /notification_rules/RULE_ID

Updates or deletes a notification rule

**Example**
```bash
curl -w 'response: %{http_code} \n' -X PUT -H "Content-type: application/json" -d \
 '{
    "notification_rules": [
      {
        "tags": [
          "database",
          "physical"
        ],
        "entities": [
          "foo-app-01.example.com"
        ],
        "time_restrictions": [
          {
            "start_time": "2013-01-28 08:00:00",
            "end_time": "2013-01-28 18:00:00",
            "rrules": [
              {
                "validations": {
                  "day": [1,2,3,4,5]
                },
                "rule_type": "Weekly",
                "interval": 1,
                "week_start": 0
              }
            ],
            "exrules": [],
            "rtimes": [],
            "extimes": []
          }
        ],
        "unknown_media": [],
        "warning_media": [
          "email"
        ],
        "critical_media": [
          "sms",
          "email"
        ],
        "unknown_blackhole": false,
        "warning_blackhole": false,
        "critical_blackhole": false
      }
    ]
  }' \
http://localhost:3081/notification_rules/08f607c7-618d-460a-b3fe-868464eb6045
```
**Response** Status: 200 OK

Returns the notification rule object as per GET.

**Example 2 - DELETE**
```bash
curl -w 'response: %{http_code} \n' -X DELETE \
 http://localhost:3081/notification_rules/08f607c7-618d-460a-b3fe-868464eb6045
```
**Response** Status: 204 OK

